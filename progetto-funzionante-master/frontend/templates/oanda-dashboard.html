<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OANDA Trading Dashboard - AI Cash Revolution</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --dark-bg: #111827;
            --card-bg: #1f2937;
            --text-light: #f9fafb;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .navbar {
            background: rgba(17, 24, 39, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }

        .card {
            background: rgba(31, 41, 55, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-connected { background-color: var(--success-color); }
        .status-disconnected { background-color: var(--danger-color); }
        .status-loading { background-color: var(--warning-color); }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .signal-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .signal-card:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
        }

        .signal-buy { border-left: 4px solid var(--success-color); }
        .signal-sell { border-left: 4px solid var(--danger-color); }
        .signal-hold { border-left: 4px solid var(--warning-color); }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
        }

        .loading-spinner {
            display: none;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top: 3px solid var(--secondary-color);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .chart-container {
            background: rgba(31, 41, 55, 0.6);
            border-radius: 8px;
            padding: 15px;
            min-height: 300px;
        }

        .metric-card {
            text-align: center;
            padding: 20px;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-label {
            color: #9ca3af;
            font-size: 0.9rem;
        }

        .connection-setup {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            border: 2px dashed rgba(59, 130, 246, 0.3);
            text-align: center;
            padding: 40px 20px;
            border-radius: 12px;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: var(--text-light);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line me-2"></i>
                AI Cash Revolution - OANDA
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard.html">
                    <i class="fas fa-tachometer-alt me-1"></i>Main Dashboard
                </a>
                <a class="nav-link" href="/signals.html">
                    <i class="fas fa-signal me-1"></i>Signals
                </a>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Connection Status -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-plug me-2"></i>OANDA Connection Status
                        </h5>
                        <div id="connection-status">
                            <div class="d-flex align-items-center">
                                <span class="status-indicator status-loading" id="status-indicator"></span>
                                <span id="status-text">Checking connection...</span>
                                <div class="loading-spinner ms-2" id="connection-spinner"></div>
                            </div>
                        </div>
                        <div class="mt-3" id="connection-actions" style="display: none;">
                            <button class="btn btn-primary" onclick="showConnectionSetup()">
                                <i class="fas fa-cogs me-1"></i>Setup Connection
                            </button>
                            <button class="btn btn-outline-success" onclick="testConnection()">
                                <i class="fas fa-sync me-1"></i>Test Connection
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Connection Setup Modal/Card -->
        <div id="connection-setup-card" style="display: none;" class="mb-4">
            <div class="card">
                <div class="card-body connection-setup">
                    <h4><i class="fas fa-link me-2"></i>OANDA Connection Setup</h4>
                    <p class="mb-4">Configure your OANDA account for AI signal generation</p>
                    
                    <div class="row justify-content-center">
                        <div class="col-md-6">
                            <form id="connection-form">
                                <div class="mb-3">
                                    <label class="form-label">Account ID (Optional - Auto-discovered)</label>
                                    <input type="text" class="form-control" id="account-id" 
                                           placeholder="Leave empty for auto-discovery">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Environment</label>
                                    <select class="form-select" id="environment">
                                        <option value="demo">Demo (Practice)</option>
                                        <option value="live">Live (Real Money)</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Risk Tolerance</label>
                                    <select class="form-select" id="risk-tolerance">
                                        <option value="LOW">Low Risk</option>
                                        <option value="MEDIUM" selected>Medium Risk</option>
                                        <option value="HIGH">High Risk</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="auto-trading">
                                        <label class="form-check-label">Enable Auto-Trading (Future Feature)</label>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary me-2">
                                    <i class="fas fa-save me-1"></i>Save Connection
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="hideConnectionSetup()">
                                    Cancel
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Info & Stats -->
        <div class="row mb-4" id="account-info" style="display: none;">
            <div class="col-md-3 mb-3">
                <div class="card metric-card">
                    <div class="metric-value text-success" id="account-balance">$0.00</div>
                    <div class="metric-label">Account Balance</div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card metric-card">
                    <div class="metric-value text-info" id="account-equity">$0.00</div>
                    <div class="metric-label">Equity (NAV)</div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card metric-card">
                    <div class="metric-value text-warning" id="margin-used">$0.00</div>
                    <div class="metric-label">Margin Used</div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card metric-card">
                    <div class="metric-value text-primary" id="margin-available">$0.00</div>
                    <div class="metric-label">Available Margin</div>
                </div>
            </div>
        </div>

        <!-- Signal Generation Controls -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-magic me-2"></i>Generate Single Signal
                        </h5>
                        <div class="mb-3">
                            <label class="form-label">Symbol</label>
                            <select class="form-select" id="single-symbol">
                                <option value="EURUSD">EUR/USD</option>
                                <option value="GBPUSD">GBP/USD</option>
                                <option value="USDJPY">USD/JPY</option>
                                <option value="AUDUSD">AUD/USD</option>
                                <option value="USDCAD">USD/CAD</option>
                                <option value="USDCHF">USD/CHF</option>
                                <option value="NZDUSD">NZD/USD</option>
                                <option value="XAUUSD">XAU/USD (Gold)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Timeframe</label>
                            <select class="form-select" id="timeframe">
                                <option value="M15">15 Minutes</option>
                                <option value="M30">30 Minutes</option>
                                <option value="H1" selected>1 Hour</option>
                                <option value="H4">4 Hours</option>
                                <option value="D1">Daily</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="generateSingleSignal()">
                            <i class="fas fa-bolt me-1"></i>Generate Signal
                            <div class="loading-spinner ms-2" id="single-signal-spinner"></div>
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-layer-group me-2"></i>Generate Batch Signals
                        </h5>
                        <div class="mb-3">
                            <label class="form-label">Symbols (comma-separated)</label>
                            <input type="text" class="form-control" id="batch-symbols" 
                                   placeholder="EURUSD,GBPUSD,USDJPY" value="EURUSD,GBPUSD,USDJPY,AUDUSD,USDCAD">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Minimum Confidence (%)</label>
                            <input type="range" class="form-range" id="min-confidence" 
                                   min="50" max="95" value="60" oninput="updateConfidenceDisplay(this.value)">
                            <span id="confidence-display">60%</span>
                        </div>
                        <button class="btn btn-primary" onclick="generateBatchSignals()">
                            <i class="fas fa-rocket me-1"></i>Generate Batch
                            <div class="loading-spinner ms-2" id="batch-signals-spinner"></div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Signals -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-satellite-dish me-2"></i>Live OANDA Signals
                        </h5>
                        <div>
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshSignals()">
                                <i class="fas fa-sync me-1"></i>Refresh
                            </button>
                            <span class="badge bg-success ms-2" id="signals-count">0 signals</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="signals-container">
                            <div class="text-center py-4">
                                <div class="loading-spinner mx-auto mb-3" id="signals-loading"></div>
                                <p class="text-muted">Loading signals...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global state
        let connectionStatus = false;
        let accountInfo = null;
        let refreshInterval = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            checkConnectionStatus();
            loadLiveSignals();
            
            // Set up auto-refresh every 30 seconds
            refreshInterval = setInterval(loadLiveSignals, 30000);
            
            // Set up connection form
            document.getElementById('connection-form').addEventListener('submit', handleConnectionSetup);
        });

        // Connection Management
        async function checkConnectionStatus() {
            try {
                showSpinner('connection-spinner', true);
                
                const response = await fetch('/api/oanda/connection', {
                    headers: {
                        'Authorization': `Bearer ${getToken()}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (response.ok && result.status === 'success' && result.data.connected) {
                    updateConnectionStatus(true, 'Connected to OANDA', result.data);
                } else if (result.data && result.data.setup_required) {
                    updateConnectionStatus(false, 'Setup required', null);
                    document.getElementById('connection-actions').style.display = 'block';
                } else {
                    updateConnectionStatus(false, 'Disconnected', null);
                    document.getElementById('connection-actions').style.display = 'block';
                }
            } catch (error) {
                console.error('Connection check failed:', error);
                updateConnectionStatus(false, 'Connection check failed', null);
                document.getElementById('connection-actions').style.display = 'block';
            } finally {
                showSpinner('connection-spinner', false);
            }
        }

        function updateConnectionStatus(connected, statusText, accountData) {
            const indicator = document.getElementById('status-indicator');
            const text = document.getElementById('status-text');
            
            if (connected) {
                indicator.className = 'status-indicator status-connected';
                text.innerHTML = `<strong>${statusText}</strong>`;
                
                if (accountData && accountData.account_info) {
                    displayAccountInfo(accountData.account_info, accountData.currency);
                }
                connectionStatus = true;
            } else {
                indicator.className = 'status-indicator status-disconnected';
                text.innerHTML = statusText;
                hideAccountInfo();
                connectionStatus = false;
            }
        }

        function displayAccountInfo(info, currency) {
            document.getElementById('account-balance').textContent = formatCurrency(info.balance, currency);
            document.getElementById('account-equity').textContent = formatCurrency(info.equity, currency);
            document.getElementById('margin-used').textContent = formatCurrency(info.margin_used, currency);
            document.getElementById('margin-available').textContent = formatCurrency(info.margin_available, currency);
            document.getElementById('account-info').style.display = 'block';
        }

        function hideAccountInfo() {
            document.getElementById('account-info').style.display = 'none';
        }

        // Connection Setup
        function showConnectionSetup() {
            document.getElementById('connection-setup-card').style.display = 'block';
        }

        function hideConnectionSetup() {
            document.getElementById('connection-setup-card').style.display = 'none';
        }

        async function handleConnectionSetup(event) {
            event.preventDefault();
            
            const formData = {
                account_id: document.getElementById('account-id').value || null,
                environment: document.getElementById('environment').value,
                risk_tolerance: document.getElementById('risk-tolerance').value,
                auto_trading_enabled: document.getElementById('auto-trading').checked,
                max_position_size: 1.0,
                daily_loss_limit: 1000.0
            };

            try {
                const response = await fetch('/api/oanda/connect', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${getToken()}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    showToast('Success', 'OANDA connection configured successfully!', 'success');
                    hideConnectionSetup();
                    checkConnectionStatus();
                } else {
                    showToast('Error', result.detail || 'Failed to setup connection', 'error');
                }
            } catch (error) {
                console.error('Connection setup failed:', error);
                showToast('Error', 'Connection setup failed', 'error');
            }
        }

        async function testConnection() {
            await checkConnectionStatus();
        }

        // Signal Generation
        async function generateSingleSignal() {
            const symbol = document.getElementById('single-symbol').value;
            const timeframe = document.getElementById('timeframe').value;
            
            try {
                showSpinner('single-signal-spinner', true);
                
                const response = await fetch(`/api/oanda/signals/generate/${symbol}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${getToken()}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ timeframe: timeframe })
                });

                const result = await response.json();

                if (response.ok) {
                    showToast('Success', `Signal generated for ${symbol}!`, 'success');
                    loadLiveSignals(); // Refresh signals
                    
                    // Show signal details in modal or expand
                    displaySignalDetails(result.data.signal);
                } else {
                    showToast('Error', result.detail || 'Failed to generate signal', 'error');
                }
            } catch (error) {
                console.error('Signal generation failed:', error);
                showToast('Error', 'Signal generation failed', 'error');
            } finally {
                showSpinner('single-signal-spinner', false);
            }
        }

        async function generateBatchSignals() {
            const symbols = document.getElementById('batch-symbols').value;
            const minConfidence = document.getElementById('min-confidence').value;
            const timeframe = document.getElementById('timeframe').value;
            
            try {
                showSpinner('batch-signals-spinner', true);
                
                const params = new URLSearchParams({
                    symbols: symbols,
                    timeframe: timeframe,
                    min_confidence: minConfidence
                });

                const response = await fetch(`/api/oanda/signals/batch?${params}`, {
                    headers: {
                        'Authorization': `Bearer ${getToken()}`,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    showToast('Success', `Generated ${result.data.total_saved} batch signals!`, 'success');
                    loadLiveSignals(); // Refresh signals
                } else {
                    showToast('Error', result.detail || 'Failed to generate batch signals', 'error');
                }
            } catch (error) {
                console.error('Batch signal generation failed:', error);
                showToast('Error', 'Batch signal generation failed', 'error');
            } finally {
                showSpinner('batch-signals-spinner', false);
            }
        }

        // Live Signals
        async function loadLiveSignals() {
            try {
                showSpinner('signals-loading', true);
                
                const response = await fetch('/api/oanda/signals/live?limit=20&min_reliability=55', {
                    headers: {
                        'Authorization': `Bearer ${getToken()}`,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    displaySignals(result.data.signals);
                    document.getElementById('signals-count').textContent = `${result.data.count} signals`;
                } else {
                    console.error('Failed to load signals:', result);
                    document.getElementById('signals-container').innerHTML = 
                        '<div class="text-center py-4"><p class="text-danger">Failed to load signals</p></div>';
                }
            } catch (error) {
                console.error('Error loading signals:', error);
                document.getElementById('signals-container').innerHTML = 
                    '<div class="text-center py-4"><p class="text-danger">Error loading signals</p></div>';
            } finally {
                showSpinner('signals-loading', false);
            }
        }

        function displaySignals(signals) {
            const container = document.getElementById('signals-container');
            
            if (signals.length === 0) {
                container.innerHTML = '<div class="text-center py-4"><p class="text-muted">No signals available</p></div>';
                return;
            }

            const signalsHtml = signals.map(signal => `
                <div class="signal-card card mb-3 signal-${signal.signal_type.toLowerCase()}" onclick="showSignalDetails(${JSON.stringify(signal).replace(/"/g, '&quot;')})">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <h6 class="mb-1">${signal.symbol}</h6>
                                <small class="text-muted">${signal.timeframe}</small>
                            </div>
                            <div class="col-md-2">
                                <span class="badge bg-${getSignalTypeColor(signal.signal_type)} fs-6">
                                    ${signal.signal_type}
                                </span>
                            </div>
                            <div class="col-md-2">
                                <div class="text-center">
                                    <div class="fw-bold">${signal.entry_price}</div>
                                    <small class="text-muted">Entry</small>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="text-center">
                                    <div class="text-success fw-bold">${signal.reliability}%</div>
                                    <small class="text-muted">Reliability</small>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="text-center">
                                    <div class="text-info fw-bold">${signal.risk_reward_ratio.toFixed(2)}</div>
                                    <small class="text-muted">R/R</small>
                                </div>
                            </div>
                            <div class="col-md-2 text-end">
                                <small class="text-muted">
                                    ${formatTimeAgo(signal.timestamp)}
                                </small>
                                <br>
                                <small class="badge bg-secondary">${signal.market_session}</small>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = signalsHtml;
        }

        function showSignalDetails(signal) {
            // Create and show modal with detailed signal information
            const modalHtml = `
                <div class="modal fade" id="signalModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="background: var(--card-bg); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-chart-line me-2"></i>
                                    ${signal.symbol} Signal Details
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <h6>Trade Information</h6>
                                        <table class="table table-dark table-striped">
                                            <tr><td>Signal Type</td><td><span class="badge bg-${getSignalTypeColor(signal.signal_type)}">${signal.signal_type}</span></td></tr>
                                            <tr><td>Entry Price</td><td>${signal.entry_price}</td></tr>
                                            <tr><td>Stop Loss</td><td>${signal.stop_loss}</td></tr>
                                            <tr><td>Take Profit</td><td>${signal.take_profit}</td></tr>
                                            <tr><td>Risk/Reward</td><td>${signal.risk_reward_ratio.toFixed(2)}</td></tr>
                                            <tr><td>Position Size</td><td>${signal.position_size_suggestion} lots</td></tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Analysis Metrics</h6>
                                        <table class="table table-dark table-striped">
                                            <tr><td>Reliability</td><td>${signal.reliability}%</td></tr>
                                            <tr><td>Confidence</td><td>${signal.confidence}%</td></tr>
                                            <tr><td>Risk Level</td><td>${signal.risk_level}</td></tr>
                                            <tr><td>Market Session</td><td>${signal.market_session}</td></tr>
                                            <tr><td>Timeframe</td><td>${signal.timeframe}</td></tr>
                                            <tr><td>Data Provider</td><td>${signal.source}</td></tr>
                                        </table>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-12">
                                        <h6>Technical Indicators</h6>
                                        <div class="row">
                                            <div class="col-md-4">RSI: ${signal.technical_indicators.rsi ? signal.technical_indicators.rsi.toFixed(2) : 'N/A'}</div>
                                            <div class="col-md-4">MACD Signal: ${signal.technical_indicators.macd_signal ? signal.technical_indicators.macd_signal.toFixed(5) : 'N/A'}</div>
                                            <div class="col-md-4">Technical Score: ${signal.technical_indicators.technical_score ? signal.technical_indicators.technical_score.toFixed(1) : 'N/A'}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <h6>AI Analysis</h6>
                                        <div class="p-3" style="background: rgba(0,0,0,0.3); border-radius: 8px; max-height: 200px; overflow-y: auto;">
                                            ${signal.explanation || 'AI analysis not available'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-success" onclick="executeSignal(${signal.id})">
                                    <i class="fas fa-play me-1"></i>Execute Trade
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal and add new one
            const existingModal = document.getElementById('signalModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = new bootstrap.Modal(document.getElementById('signalModal'));
            modal.show();
        }

        // Utility Functions
        function formatCurrency(amount, currency = 'USD') {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency
            }).format(amount);
        }

        function formatTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffInSeconds = Math.floor((now - time) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            return `${Math.floor(diffInSeconds / 86400)}d ago`;
        }

        function getSignalTypeColor(type) {
            switch (type.toUpperCase()) {
                case 'BUY': return 'success';
                case 'SELL': return 'danger';
                case 'HOLD': return 'warning';
                default: return 'secondary';
            }
        }

        function showSpinner(id, show) {
            const spinner = document.getElementById(id);
            if (spinner) {
                spinner.style.display = show ? 'inline-block' : 'none';
            }
        }

        function showToast(title, message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container');
            const toastId = 'toast-' + Date.now();
            
            const bgClass = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-danger' : 'bg-info';
            
            const toastHtml = `
                <div id="${toastId}" class="toast ${bgClass}" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
                    <div class="toast-header">
                        <strong class="me-auto">${title}</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            const toast = new bootstrap.Toast(document.getElementById(toastId));
            toast.show();
            
            // Remove toast element after it's hidden
            document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
                this.remove();
            });
        }

        function updateConfidenceDisplay(value) {
            document.getElementById('confidence-display').textContent = value + '%';
        }

        function refreshSignals() {
            loadLiveSignals();
        }

        function getToken() {
            return localStorage.getItem('access_token');
        }

        function logout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            window.location.href = '/login.html';
        }

        async function executeSignal(signalId) {
            // This would integrate with the trading execution system
            showToast('Info', 'Signal execution feature coming soon!', 'info');
        }
    </script>
</body>
</html>
