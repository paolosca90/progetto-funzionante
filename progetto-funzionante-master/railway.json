{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "nixpacks",
    "buildCommand": "python -m pip install -r requirements.txt && python railway_check.py"
  },
  "deploy": {
    "startCommand": "python -m uvicorn main:app --host 0.0.0.0 --port $PORT",
    "healthcheckPath": "/health",
    "healthcheckTimeout": 300,
    "restartPolicyType": "ON_FAILURE",
    "sleepApplication": true
  },
  "environments": {
    "production": {
      "variables": {
        "ENVIRONMENT": "production",
        "PYTHONPATH": "/app",
        "PYTHONUNBUFFERED": "1",

        "DATABASE_URL": "${{Postgres.DATABASE_URL}}",
        "PORT": "${{PORT}}",

        "JWT_SECRET_KEY": "${{JWT_SECRET_KEY}}",
        "SECRET_KEY": "${{RAILWAY_ENVIRONMENT}}-${{RAILWAY_SERVICE_NAME}}-${{RAILWAY_PROJECT_NAME}}",

        "OANDA_API_KEY": "${{OANDA_API_KEY}}",
        "OANDA_ACCOUNT_ID": "${{OANDA_ACCOUNT_ID}}",
        "OANDA_ENVIRONMENT": "${{OANDA_ENVIRONMENT}}",

        "GEMINI_API_KEY": "${{GEMINI_API_KEY}}",

        "EMAIL_HOST": "${{EMAIL_HOST}}",
        "EMAIL_USER": "${{EMAIL_USER}}",
        "EMAIL_PASSWORD": "${{EMAIL_PASSWORD}}",
        "EMAIL_FROM": "${{EMAIL_USER}}",

        "REDIS_URL": "${{REDIS_URL}}",
        "REDIS_PASSWORD": "${{REDIS_PASSWORD}}",

        "SENTRY_DSN": "${{SENTRY_DSN}}",
        "SENTRY_TRACES_SAMPLE_RATE": "0.2",
        "SENTRY_PROFILES_SAMPLE_RATE": "0.1"
      }
    }
  }
}
